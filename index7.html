<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Product Results Tracker</title>
<link rel="stylesheet" href="style2.css">
<link href="https://fonts.googleapis.com/css2?family=Catamaran:wght@400;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Catamaran:wght@400;700&family=Paytone+One&display=swap" rel="stylesheet">
</head>
<body>

<div class="container">
  <div class="card">
    <a href="index.html" class="home-icon" title="Go Home">
     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="home-svg">
     <path d="M3 9.5L12 3l9 6.5V21a1 1 0 0 1-1 1h-5v-6H9v6H4a1 1 0 0 1-1-1V9.5z" />
     </svg>
    </a>
    <h1 id="titleprt">Product Results Tracker</h1>
    <div class="button-wrapper">
      <a href="index8.html"><button>Add New Product</button></a>
    </div>
  </div>

  <div class="card">
    <h3 id="savedProductstitle">Saved Products</h3>
    <div id="productList"></div>
  </div>
</div>

<!-- Modal -->
<div id="modalOverlay">
  <div id="modalContent">
    <h3>Product Details</h3>
    <div id="productDetails"></div>
    <div class="button-wrapper">
      <button id="editBtn">Edit</button>
      <button id="deleteBtn">Delete</button>
      <button onclick="closeModal()">Close</button>
    </div>
  </div>
</div>

<script>
function loadProducts() { return JSON.parse(localStorage.getItem("products")) || []; }
function saveProducts(products) { localStorage.setItem("products", JSON.stringify(products)); }

let products = loadProducts();
let currentIndex = null;

function calculateRepurchase(p) {
  const { moisture, definition, noBuildup, overall } = p.ratings;
  return Math.round(((moisture + definition + noBuildup + overall)/20)*100);
}

function renderProducts() {
  const list = document.getElementById("productList");
  list.innerHTML = "";
  if (products.length === 0) {
    list.innerHTML = "<p style='text-align:center;'>No products saved yet.</p>";
    return;
  }

  products.forEach((p, index) => {
    const repurchase = calculateRepurchase(p);

    // Determine bar color based on percentage
    let barColor = "#67B271";
    if (repurchase < 30) barColor = "#EF5B9C";
    else if (repurchase < 60) barColor = "#FFAF65";
    else if (repurchase < 80) barColor = "#FFE865";

    const div = document.createElement("div");
    div.className = "product-entry";
    div.innerHTML = `
      <div><strong>${p.brand} - ${p.name}</strong></div>
      <div>
        Repurchase Likelihood:
        <div class="repurchase-bar">
          <div class="repurchase-fill" style="width:${repurchase}%; background:${barColor};"></div>
        </div>
        <small>${repurchase}%</small>
      </div>
      <div class="button-wrapper">
        <button onclick="viewProduct(${index})">View</button>
      </div>
    `;
    list.appendChild(div);
  });
}


function renderStars(rating) {
  let stars = "";
  for(let i=1;i<=5;i++){ stars += i<=rating?"★":"☆"; }
  return stars;
}

function viewProduct(index){
  currentIndex=index;
  const p=products[index];
  const detailsDiv=document.getElementById("productDetails");
  detailsDiv.innerHTML=`
    <p><strong>Name:</strong> ${p.name}</p>
    <p><strong>Brand:</strong> ${p.brand}</p>
    <p><strong>Date:</strong> ${p.date}</p>
    <p><strong>Moisture:</strong> ${renderStars(p.ratings.moisture)}</p>
    <p><strong>Definition:</strong> ${renderStars(p.ratings.definition)}</p>
    <p><strong>No Buildup:</strong> ${renderStars(p.ratings.noBuildup)}</p>
    <p><strong>Overall:</strong> ${renderStars(p.ratings.overall)}</p>
    <p><strong>Notes:</strong> ${p.optional.notes||"None"}</p>
    <p><strong>Repurchase Likelihood:</strong> ${calculateRepurchase(p)}%</p>
  `;
  document.getElementById("modalOverlay").style.display="flex";
}

function closeModal(){ document.getElementById("modalOverlay").style.display="none"; currentIndex=null; }

document.getElementById("editBtn").addEventListener("click", ()=>{
  if(currentIndex===null) return;
  window.location.href=`index8.html?edit=${currentIndex}`;
});

document.getElementById("deleteBtn").addEventListener("click", ()=>{
  if(currentIndex===null) return;
  if(confirm("Delete this product?")){
    products.splice(currentIndex,1);
    saveProducts(products);
    renderProducts();
    closeModal();
  }
});

renderProducts();
</script>

</body>
</html>
